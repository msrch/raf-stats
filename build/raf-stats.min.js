/*!
 * raf-status v0.0.1
 * Request Animation Frame performance monitor.
 * https://github.com/msrch/raf-stats.git
 * (c) 2013 Michal Srch, License MIT
 */
!function(a,b){"use strict";var c,d=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||!1,e="undefined"!=typeof a.RAFstats?a.RAFstats:!1,f=function(){return(new Date).getTime()},g={initialised:!1,touch_support:"ontouchstart"in a||"onmsgesturechange"in a,settings:{width:150,height:50},stats:null,display:null,view:0,layouts:["viewFps","viewMs","viewAll","viewSimple"],getFrame:function(){d(function(){g.initialised&&(g.stats.nextFrame(),g.drawLayout(),g.getFrame())})},drawLayout:function(){g.display[g.layouts[g.view]]()},behaviour:{swipe_diff:25,swipe:!1,active:!1,pos_x:0,pos_y:0,action:function(a,b,c){var d=g.behaviour.swipe_diff;c&&(a+=d,b+=d),a>d||b>d?a>b?g.api.toggleSides():g.api.reset():g.api.nextView()},handleEvent:function(a){var b,c,d,e,f,h=g.behaviour;"touchstart"===a.type||"touchleave"===a.type||"touchcancel"===a.type||"touchend"===a.type?(f=a.touches[0]||a.changedTouches[0],d=f.pageX,e=f.pageY):(d=a.clientX,e=a.clientY),"mousedown"===a.type||"touchstart"===a.type?(h.pos_x=d,h.pos_y=e,h.active=!0):(("mouseout"===a.type||"touchleave"===a.type||"touchcancel"===a.type)&&(h.swipe=!0),h.active&&(b=Math.abs(h.pos_x-d),c=Math.abs(h.pos_y-e),h.action(b,c,h.swipe),h.active=!1),h.swipe=!1),a.stopPropagation(),a.preventDefault()}},api:{init:function(){var a=function(a){g.display.canvas.addEventListener(a,g.behaviour,!1)};return!g.initialised&&(g.display=new j(g.settings.width,g.settings.height),g.display.supported)?(a("mousedown"),a("mouseup"),a("mouseout"),g.display.canvas.style.cursor="pointer",g.touch_support&&(a("touchstart"),a("touchleave"),a("touchcancel"),a("touchend")),g.stats=new h(g.settings.width),g.initialised=!0,g.getFrame(),!0):!1},nextView:function(){return g.view=g.view+1>=g.layouts.length?0:g.view+1},toggleSides:function(){return g.initialised?(g.display.canvas.style.right="auto"===g.display.canvas.style.right?0:"auto",g.display.canvas.style.left="auto"===g.display.canvas.style.left?0:"auto",!0):!1},reset:function(){return g.initialised?(g.stats=new h(g.settings.width),j._fps_refresh=null,!0):g.api.init()},destroy:function(){return g.initialised?(g.stats=null,g.display.destroy(),g.display=null,g.initialised=!1,!0):!1}}},h=function(a){this.history_max=a,this.fps=0,this.fps_min=1/0,this.fps_max=0,this.fps_avg=0,this.fps_total=0,this.fps_count=0,this.fps_calc_seconds=0,this.fps_calc_frames=0,this.fps_history=[],this.ms=0,this.ms_min=0,this.ms_max=1/0,this.ms_avg=0,this.ms_total=0,this.ms_count=0,this.ms_history=[],this.time_now=f()};h.prototype.nextFrame=function(){var a=f(),b=a-this.time_now;this.ms=b,this.ms_total+=b,this.ms_count+=1,this.storeMs(b),this.calcMsStats(b),this.fps_calc_seconds+=b,this.fps_calc_frames+=1,this.fps_calc_seconds>=1e3&&(this.fps=this.fps_calc_frames,this.fps_total+=this.fps_calc_frames,this.fps_count+=1,this.storeFps(this.fps_calc_frames),this.calcFpsStats(this.fps_calc_frames),this.fps_calc_seconds=0,this.fps_calc_frames=0),this.time_now=a},h.prototype.calcMsStats=function(a){a>this.ms_min&&(this.ms_min=a),a<this.ms_max&&(this.ms_max=a),this.ms_avg=Math.round(this.ms_total/this.ms_count)},h.prototype.calcFpsStats=function(a){a>this.fps_max&&(this.fps_max=a),a<this.fps_min&&(this.fps_min=a),this.fps_avg=Math.round(this.fps_total/this.fps_count)},h.prototype.storeMs=function(a){this.ms_history.push(a),this.ms_history.length>this.history_max&&this.ms_history.shift()},h.prototype.storeFps=function(a){this.fps_history.push(a),this.fps_history.length>this.history_max&&this.fps_history.shift()};var i=function(a,b,c,d,e,f,g,h,i){this.width=a,this.height=b,this.bottom=d,this.left=c,this.limit_good=f,this.limit_warning=g,this.limit_poor=h,this.scale=b/e,this.logic_invert="undefined"!=typeof i&&i===!0};i.colors={excellent:"#0BE400",good:"#0DAC05",warning:"#d88c08",poor:"#d80808"},i.prototype.getColor=function(a){var b=this.constructor.colors;return this.logic_invert?a>this.limit_poor?b.poor:a<=this.limit_good?b.excellent:a<=this.limit_warning?b.good:a<=this.limit_poor?b.warning:void 0:a<this.limit_poor?b.poor:a<this.limit_warning?b.warning:a<this.limit_good?b.good:b.excellent},i.prototype.render=function(a,b){var c,d,e,f,h,i,j=b.length,k=j-this.width<0?0:j-this.width,l=1;for(h=j-1,i=this.width;h>=k;h-=1,i-=1)f=b[h],c=this.left+i-1,e=Math.round(f*this.scale),0>=e&&(e=1),e>this.height&&(e=this.height),d=g.settings.height-this.bottom-e,a.beginPath(),a.rect(c,d,l,e),a.fillStyle=this.getColor(f),a.fill()};var j=function(a,c){var d=b.querySelector("body"),e=b.createElement("canvas");e.getContext?(e.width=a,e.height=c,e.display="block",e.style.position="fixed",e.style.top=0,e.style.right=0,e.style.left="auto",e.style.zIndex=999999999,d.appendChild(e),this.canvas=e,this.ctx=e.getContext("2d"),this.supported=!0):(this.supported=!1,alert("You browser doesn't support canvas!"))};j.settings={color:{bg:"rgba(0,0,0,0.85)",value:"white",nfo:"#999999"},font:"sans-serif","char":{max:"▲",min:"▼",avg:"★"}},j.prototype.clear=function(){var a=this.ctx;a.clearRect(0,0,this.canvas.width,this.canvas.height),a.beginPath(),a.rect(0,0,this.canvas.width,this.canvas.height),a.fillStyle=this.constructor.settings.color.bg,a.fill()},j._fps_refresh=null,j.FpsGraph=new i(g.settings.width,g.settings.height-20,0,0,70,60,30,25),j.prototype.viewFps=function(){var a=this.ctx,b=this.constructor,c=b.settings.color,d=b.settings.char,e=b.settings.font,f=b._fps_refresh;f!==g.stats.fps_count&&(f=g.stats.fps_count,this.clear(),a.font="bold 9px "+e,a.textAlign="left",a.fillStyle=c.value,a.fillText(g.stats.fps+" fps",5,12),a.font="9px "+e,a.textAlign="right",a.fillStyle=c.nfo,a.fillText(d.max+g.stats.fps_max+"  "+d.avg+g.stats.fps_avg+"  "+d.min+(1/0===g.stats.fps_min?0:g.stats.fps_min),this.canvas.width-5,12),b.FpsGraph.render(a,g.stats.fps_history))},j.MsGraph=new i(g.settings.width,g.settings.height-20,0,0,100,18,34,40,!0),j.prototype.viewMs=function(){var a=this.ctx,b=this.constructor,c=b.settings.color,d=b.settings.char,e=b.settings.font;this.clear(),a.font="bold 9px "+e,a.textAlign="left",a.fillStyle=c.value,a.fillText(g.stats.ms+" ms",5,12),a.font="9px "+e,a.textAlign="right",a.fillStyle=c.nfo,a.fillText(d.max+(1/0===g.stats.ms_max?0:g.stats.ms_max)+"  "+d.avg+g.stats.ms_avg+"  "+d.min+g.stats.ms_min,this.canvas.width-5,12),b.MsGraph.render(a,g.stats.ms_history)},j._half_gutter=2,j._half_width=Math.round((g.settings.width-j._half_gutter)/2),j._half_2nd_col_x=j._half_width+j._half_gutter,j.AllFpsGraph=new i(j._half_width,g.settings.height-20,0,0,70,60,30,25),j.AllMsGraph=new i(j._half_width,g.settings.height-20,j._half_2nd_col_x,0,100,18,34,40,!0),j.prototype.viewAll=function(){var a=this.ctx,b=this.constructor,c=b.settings.color,d=b.settings.char,e=b.settings.font;this.clear(),a.clearRect(b._half_width,0,b._half_gutter,this.canvas.height),a.font="bold 9px "+e,a.textAlign="left",a.fillStyle=c.value,a.fillText(g.stats.fps+" fps",5,12),a.fillText(g.stats.ms+" ms",b._half_2nd_col_x+5,12),a.font="9px "+e,a.textAlign="right",a.fillStyle=c.nfo,a.fillText(d.avg+g.stats.fps_avg,b._half_width-5,12),a.fillText(d.avg+g.stats.ms_avg,this.canvas.width-5,12),b.AllFpsGraph.render(a,g.stats.fps_history),b.AllMsGraph.render(a,g.stats.ms_history)},j.prototype.viewSimple=function(){var a=this.ctx,b=this.constructor,c=b.settings.color,d=b.settings.char,e=b.settings.font,f=Math.round(b._half_width/2);this.clear(),a.clearRect(b._half_width,0,b._half_gutter,this.canvas.height),a.beginPath(),a.rect(0,0,b._half_width,g.settings.height),a.fillStyle=b.AllFpsGraph.getColor(g.stats.fps),a.fill(),a.beginPath(),a.rect(b._half_2nd_col_x,0,b._half_width,g.settings.height),a.fillStyle=b.AllMsGraph.getColor(g.stats.ms),a.fill(),a.font="bold 28px "+e,a.textAlign="center",a.fillStyle=c.value,a.fillText(g.stats.fps,f,32),a.fillText(g.stats.ms,b._half_2nd_col_x+f,32),a.font="9px "+e,a.fillText(d.avg+g.stats.fps_avg+" fps",f,44),a.fillText(d.avg+g.stats.ms_avg+" ms",b._half_2nd_col_x+f,44)},j.prototype.destroy=function(){this.canvas.remove()},d===!1?alert("You browser doesn't support requestAnimationFrame!"):(e===!1?a.RAFstats=c=g.api:c=e,c.initialised||c.init())}(window,document);